# mode-contract

## 共通契約

- 共通手順は `List -> Red -> Green -> Refactor` に固定する。
- 各サイクルで「対象テスト実行」と「回帰確認」を記録する。
- 失敗テストなしで実装へ進まない。
- 指定がなければ `plan-only` を使う。
- 停止時は必ず `Recovery Matrix` を出力する。
- 終了時は必ず `Done Criteria` を評価し、`Exit Check` を `PASS|FAIL` で出力する。

## Done Criteria（全モード共通）

- 対象の受け入れ条件に対応するテストがすべて Green。
- 回帰確認コマンドが Green。
- 対象外失敗の扱いが明記されている。
- 変更内容と残課題が 1 ブロックで要約されている。

## plan-only

### 目的

- 実装前に最小サイクルを決める。

### 入力

- `target`: 対象機能または対象挙動。
- `scope`: 対象範囲。未指定なら最小範囲を提案する。

### 出力

- `references/plan-output-template.md` の見出し順で出力する。
- 最初に実行する 1 サイクルを具体化する。
- 実行コマンドは候補ではなく確定値を記載する。
- 実装担当がそのまま使える `Execution Handoff` を記載する。
- 停止条件ごとの復旧を `Recovery Matrix` に記載する。
- `Done Criteria` と現在時点の `Exit Check` を記載する。

### 禁止

- コード編集を行わない。
- 実装案を複数並べて判断を先送りしない。

## stepwise

### 目的

- 1 サイクルずつ実行し、各ゲートを明示的に通過する。

### 必須ゲート

- Red ゲート: 新規テストが失敗していることを確認する。
- Green ゲート: 直前の失敗テストが成功することを確認する。
- Refactor ゲート: 対象テストと回帰テストが成功することを確認する。

### 出力

- 各サイクルで `Red/Green/Refactor` の結果を 1 行ずつ残す。
- 次サイクルへ進む前に「次に行う 1 手」を明示する。
- 最終サイクル後に `Done Criteria` 評価結果と `Exit Check` を記載する。

## fast-track

### 目的

- 対話回数を減らしつつ、TDD の必須ゲートを維持する。

### 省略可能

- 中間説明の詳細化。
- 複数案の比較説明。

### 省略不可

- Red の失敗確認。
- Green の成功確認。
- Refactor 後の再実行。

### 出力

- サイクルごとの結果を短く集約して報告する。
- 最終サイクル後に `Done Criteria` 評価結果と `Exit Check` を記載する。
